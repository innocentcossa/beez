{% extends "base.html" %}

{% block pageContent %}

</div>
<div class="col-8">
  <div class="form-group mb-3">
  </div>
</div>

<div class="mdc-layout-grid__inner">
  <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
    <div class="mdc-card py-2">
      <div class="d-flex justify-content-between align-items-center">
          <h4 class="card-title mb-0">Revenue Structure</h4>
           <a class="btn btn-primary bg-gradient btn-sm rounded-0" href="{% url 'Beezfees:payment_methods' %}"><span>Payment methods</span></a>
          <div class="text-start"> <a class="btn btn-primary bg-gradient btn-sm rounded-0" href="{% url 'Beezfees:revenue_group' %}"><span>Revenue Group</span></a>

          </div>
          
  
          </div>
      </div>
      </div>
  </div>    
    <div class="container-fluid">
      <form action="{% url 'Beezfees:revenue_structure' %}" id="form" method="post">        <input type="hidden" name="id">
        {% csrf_token %}
        <div class="row">
          <div class="col-5">
            <div class="form-group mb-3">
              <label for="col_ordinance_code" class="control-label">Ordinance number</label>
              <select name="col_ordinance_code" id="ordinance-number" class="form-control form-control-sm rounded-0" required>
                <option value="" disabled selected>Select Ordinance number</option>
                
                
              </select>
            </div>
          </div>

          <div class="col-5">
            <div class="form-group mb-3">
              <label for="col_group-code" class="control-label">Group code</label>
              <select name="col_group_code" id="group-code" class="form-control form-control-sm rounded-0" required>
                <option value="" disabled selected>Select Group code</option>
                
                  
                
              </select>
            </div>
          </div>
          
          <div class="col-5">
            <div class="form-group mb-3">
              <label for="session-code" class="control-label">Session id</label>
              <select name="col_session_id"  id="session-id" class="form-control form-control-sm rounded-0" required>
                <option value="" disabled selected>Select Session Code</option>
                
                  
              </select>
            </div>
          </div>
          
          <div class="col-5">
            <div class="form-group mb-3">
              <label for="col_curr_code" class="control-label">Currency Code</label>
              <select name="col_curr_code" id="currency-code" class="form-control form-control-sm rounded-0" required>
                <option value="" disabled selected>Select Currency code</option>
                
              </select>
            </div>
          </div>


          <div class="col-5">
            <div class="form-group mb-3">
              <label for="revenue-name" class="control-label">Revenue Name</label>
              <select name="col_revenue_name" id="revenue-name" class="form-control form-control-sm rounded-0" required>
                <option value="" disabled selected>Select Revenue Name</option>
              </select>
            </div>
          </div>
          
          
          
          <div class="col-5">
            <div class="form-group mb-3">
              <label for="fees-amount" class="control-label"> Amount</label>
              <input type="DECIMAL" name="col_fee_amount" id="fees-amount" placeholder="" class="form-control form-control-sm rounded-0" value="" required>
            </div>
          </div>


          <div class="col-12">
            <div class="form-group mb-3">
              <button type="submit" class="btn btn-primary">Save</button>
              <button type="button" class="btn btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      </form>


<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
  <div class="mdc-card py-2">
      <div class="d-flex justify-content-between align-items-center">
          <h4 class="card-title mb-0">Revenue Structure List</h4>

          <div class="text-start">
    
          </div>
  
      </div>
  </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
  <div class="mdc-card">
    <div class="table-responsive">
      <table class="table table-striped table-bordered" id="example">
        <colgroup>
          <col width="10%">
          <col width="15%">
          <col width="15%">
          <col width="10%">
          <col width="10%">
          <col width="20%">
          <col width="20%">
        </colgroup>
        <thead>
          <tr>
            
            <th class="text-left py-1">Ref Id</th>
            <th class="text-left py-1">Session Code</th>
            <th class="text-left py-1">Group Code</th>
            <th class="text-left py-1">Ordinance Code</th>
            <th class="text-left py-1">Currency </th>
            <th class="text-left py-1">Revenue Name</th>
            <th class="text-right py-1">Amount</th>
            
          </tr>
        </thead>
        <tbody>
          {% for revenue_structure in revenue_structure_list %}
          {% for curr in curr %}
          {% for ord in ord %}
          {% for grp in grp %}
          {% for ssn in ssn %}
          
          {% if revenue_structure.col_session_id == ssn.col_session_id %}
          {% if revenue_structure.col_group_code == grp.col_group_code %}
          {% if revenue_structure.col_ordinance_code == ord.col_ordinance_code %}
          <tr>
            <td class="px-2 py-1 text-center">
              <a href="#" onclick="populateSessionInfo('{{ revenue_structure.col_ref_id}}', '{{ revenue_structure.col_session_id }}', '{{ revenue_structure.col_group_code  }}', '{{  revenue_structure.col_ordinance_code }}', '{{ revenue_structure.col_curr_code}}', '{{ revenue_structure.col_revenue_name }}', '{{ revenue_structure.col_fee_amount }}')">
                  {{ revenue_structure.col_ref_id}}
              </a>
          
            <td class="px-2 py-1 text-left">{{ revenue_structure.col_session_id }} [{{ ssn.col_session_name }}]</td>
            <td class="px-2 py-1 text-left">{{ revenue_structure.col_group_code }} [{{ grp.col_group_name }}]</td>
            <td class="px-2 py-1 text-left">{{ revenue_structure.col_ordinance_code }}</td>
            <td class="px-2 py-1 text-left">{{ revenue_structure.col_curr_code }} </td>
            <td class="px-2 py-1 text-left">{{ revenue_structure.col_revenue_name }}</td>
            <td class="px-2 py-1 text-right">{{ revenue_structure.col_fee_amount }}</td>
  
            </td>
          </tr>
          
          {% endif %}
          {% endif %}
          {% endif %}
          {% endfor %}
          {% endfor %}
          {% endfor %}
          {% endfor %}
          {% endfor %}
     
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>$(document).ready(function() {
  $.ajax({
    url: '/fetch_ordinance_codes/',
    type: 'GET',
    dataType: 'json',
    success: function(data) {
      var select = document.getElementById('ordinance-number');
      data.forEach(function(item) {
        var option = document.createElement('option');
        option.value = item;
        option.text = item;
        select.appendChild(option);
      });
    },
    error: function() {
      console.log('Error occurred while fetching ordinance numbers.');
    }
  });

  $.ajax({
    url: '/fetch_group_codes/',
    type: 'GET',
    dataType: 'json',
    success: function(data) {
      var select = document.getElementById('group-code');
      data.forEach(function(item) {
        var option = document.createElement('option');
        option.value = item;
        option.text = item;
        select.appendChild(option);
      });
    },
    error: function() {
      console.log('Error occurred while fetching group codes.');
    }
  });

  $.ajax({
    url: '/fetch_currency_codes/',
    type: 'GET',
    dataType: 'json',
    success: function(data) {
      var select = document.getElementById('currency-code');
      data.forEach(function(item) {
        var option = document.createElement('option');
        option.value = item;
        option.text = item;
        select.appendChild(option);
      });
    },
    error: function() {
      console.log('Error occurred while fetching currency codes.');
    }
  });

  $.ajax({
    url: '/fetch_revenue_codes/',
    type: 'GET',
    dataType: 'json',
    success: function(data) {
      var select = document.getElementById('revenue-name');
      data.forEach(function(item) {
        var option = document.createElement('option');
        option.value = item;
        option.text = item;
        select.appendChild(option);
      });
    },
    error: function() {
      console.log('Error occurred while fetching revenue codes.');
    }
  });

  $.ajax({
    url: '/fetch_session_codes/',
    type: 'GET',
    dataType: 'json',
    success: function(data) {
      var select = document.getElementById('session-id');
      data.forEach(function(item) {
        var option = document.createElement('option');
        option.value = item;
        option.text = item;
        select.appendChild(option);
      });
    },
    error: function() {
      console.log('Error occurred while fetching session codes.');
    }
  });
});

</script>
  </form>
  </div>

{% endblock pageContent %}
{% block ScriptBlock %}
<script>
    function populateSessionInfo(refId, ssnCode,revCode,ordCode,currCode,revName,feeAmount) {
        document.getElementById("col_ref_id ").value = refId;
        document.getElementById("col_session_code").value = ssnCode;
        document.getElementById("col_group_code").value = revCode;
        document.getElementById("col_ordinance_code").value = ordCode;
        document.getElementById("col_curr_code").value = currCode;
        document.getElementById("col_revenue_name").value = revName;
        document.getElementById("col_fee_amount").value = feeAmount;
        
      }
    </script>
    
{% endblock ScriptBlock %}

